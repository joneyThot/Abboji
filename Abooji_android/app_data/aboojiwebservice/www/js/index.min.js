var local_user_pro,all_locations,serviceUrl,imageUrl,adverts_data,category_data,premiumoffers_data,todayspecial_data,search_result_data,all_data,current_lat,current_lun;local_user_pro=localStorage.getItem("user_profile");serviceUrl="http://108.163.162.132/abooji/abooji_webservice/";imageUrl="http://108.163.162.132/abooji/uploads/discount/";var adverts_load=false,category_load=false,premiumoffers_load=false,card_load=false,todayspecial_load=false,all_data_load=false;var app={initialize:function(){this.bindEvents();},bindEvents:function(){document.addEventListener('deviceready',this.onDeviceReady,false);document.addEventListener('offline',this.isOffline,false);document.addEventListener('online',this.isOnline,false);document.addEventListener('menubutton',this.onMenuKeyDown,false);},onDeviceReady:function(){app.receivedEvent('deviceready');},receivedEvent:function(id){var parentElement=document.getElementById(id);var listeningElement=parentElement.querySelector('.listening');var receivedElement=parentElement.querySelector('.received');listeningElement.setAttribute('style','display:none;');receivedElement.setAttribute('style','display:block;');console.log('Received Event: '+id);},onMenuKeyDown:function(){},isOffline:function(){alert("device is OFFline");},isOnline:function(){}};$(function(){$('#menu').mmenu({onClick:{blockUI:false,preventDefault:function(){return this.rel!='external';}}},{pageSelector:'div[data-role="page"]:first'});$('#menu a[rel!="external"]').on('click',function(){var _t=this;$('#menu').one('closed.mm',function(){$.mobile.changePage(_t.href,{transition:'slide'});});});});$(document).on('pageshow',function(e,ui){$('#menu').trigger('setPage',[$(e.target)]);$('#menu a').each(function(){if($.mobile.path.parseUrl(this.href).href==window.location.href){$(this).trigger('setSelected.mm');}});});(function(doc,win){var docEl=doc.documentElement,recalc=function(){var clientWidth=docEl.clientWidth;if(!clientWidth)return;docEl.style.fontSize=clientWidth+'px';docEl.style.display="none";docEl.clientWidth;docEl.style.display="";};if(!doc.addEventListener)return;var div=doc.createElement('div');div.setAttribute('style','font-size: 1rem');if(div.style.fontSize!="1rem")return;win.addEventListener('resize',recalc,false);doc.addEventListener('DOMContentLoaded',recalc,false);})(document,window);$(document).ready(function(){var saveonSuccess=function(position){current_lat=position.coords.latitude;current_lun=position.coords.longitude;var current_location=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);localStorage.setItem('current_pos',current_location);};function onError(error){console.error('code: '+error.code+'\n'+'message: '+error.message+'\n');}navigator.geolocation.getCurrentPosition(saveonSuccess,onError);$("#select-category").change(function(){filter_list_cat($('#select-category').val());});$("#select-card").change(function(){});$("#slider").slider();$('#slider').slider().bind({slidestart:function(event,ui){},slide:function(event,ui){console.warn("slider value: "+$('#slider').val());},slidestop:function(event,ui){}});$("#list_select_range").slider();$("#search_pg_slider").slider();$("#loc_slider").change(function(){if($("#loc_slider").val()=="gps"){$("#btn_loc_gps").removeClass('ui-disabled');$("#btn_addloc_map").addClass('ui-disabled');}else{$("#btn_addloc_map").removeClass('ui-disabled');$("#btn_loc_gps").addClass('ui-disabled');}});if(local_user_pro==null||local_user_pro==undefined){$.mobile.changePage("#startupinfo");}});$(document).on("pagecontainerbeforetransition"||"pagebeforechange",function(e,data){var to_page=data.toPage[0].id;if(to_page=="tspecial"){add_loc_list("#select-loc");add_cat_list("#select-category");add_card_list("#select-card");filter_list_cat("all");reset_todays_page();}if(to_page=="listingpage"){add_loc_list("#list_select_loc");add_card_list("#list_select_card");add_cat_list("#list_select_category");}if(to_page=="search"){add_loc_list("#search_location");add_card_list("#search_card");add_cat_list("#search_category");reset_search();}if(to_page=="startupinfo"){add_cat_on_startup();}if(to_page=="search_result_pg"){add_loc_list("#search_pg_loc");add_card_list("#search_pg_card");add_cat_list("#search_pg_category");}});function on_load(){$.mobile.loading("show",{text:"Loading...",textVisible:"true",theme:"b",});var url=serviceUrl+'adverts.php';$.post(url,function(myData){adverts_data=myData.advrts;console.info("Adverts");console.log(adverts_data);adverts_load=true;hide_loader();},'json');var url=serviceUrl+'category.php';$.post(url,function(myData){category_data=myData.category;console.info("category");console.log(category_data);category_load=true;add_todays_info_to_slider();addmenu();hide_loader();},'json');var url=serviceUrl+'premiumoffers.php';$.post(url,function(myData){premiumoffers_data=myData.premiumListing;console.info("premiumoffers");console.log(premiumoffers_data);premiumoffers_load=true;add_premium_list_to_slider();hide_loader();},'json');var url=serviceUrl+'cards.php';$.post(url,function(myData){if(myData.card[0]==''){myData.card=[];}card_data=myData.card;console.info("card");console.log(card_data);card_load=true;add_todays_info_to_slider();hide_loader();},'json');var url=serviceUrl+'todayspecial.php';$.post(url,function(myData){todayspecial_data=myData.todaysspecial;console.info("todayspecial");console.log(todayspecial_data);todayspecial_load=true;add_todays_info_to_slider();hide_loader();},'json');$.getJSON('adslider.json',function(data){var output="";for(var i in data.ad){output+='<li><img src="'+data.ad[i].src+'"  onclick="'+data.ad[i].changepage+'" alt="Picture" style="height: 24vh;width: 100vw;" /></li>';}$('#adslider').append(output);$('#adslider').bxSlider({infiniteLoop:false,hideControlOnEnd:true,controls:false,adaptiveHeight:true,});});get_loc();}function hide_loader(){if(adverts_load&&category_load&&premiumoffers_load&&card_load&&todayspecial_load){$.mobile.loading("hide");}}function addmenu(){var out_html="";out_html='<li><a href="#mainpage"></a></li><li><a href="#mainpage" onclick="$.mobile.changePage(\'#mainpage\')">Home</a></li><li><a onclick="scanCode()" href="#" data-transition="flow">Barcode</a></li><li><a href="#registerpage" onclick="$.mobile.changePage(\'#registerpage\')" data-transition="flow">Sign Up</a></li><li><a href="#loginpage" onclick="$.mobile.changePage(\'#loginpage\')" data-transition="pop">Login</a></li><li data-role="list-divider" id="menu_list_li_categories">categories</li>';for(var i in category_data){out_html+='<li><a href="#category_page" onclick="call_category_page('+category_data[i].id+',\''+category_data[i].category_name+'\')" data-transition="flow">'+category_data[i].category_name+'</a></li>';}out_html+='<li data-role="list-divider">Other</li><li><a href="#mainpage" onclick="$.mobile.changePage(\'#mainpage\')" data-transition="flow">Point</a></li><li><a href="#mainpage" onclick="$.mobile.changePage(\'#mainpage\')" data-transition="flow">Discount</a></li><li><a href="#mainpage" onclick="$.mobile.changePage(\'#mainpage\')" data-transition="flow">Notification</a></li><li><a href="#listingpage" onclick="$.mobile.changePage(\'#listingpage\')" data-transition="flow">LBS</a></li><li><a href="#select_card_pg" onclick="$.mobile.changePage(\'#select_card_pg\')" data-transition="flow">All cards</a></li>';$('#ul_menu').html(out_html);}function call_category_page(cat_id,cat_name){$('#cat_title').html(cat_name);if(all_data_load){add_category_data(cat_id);}else{$.mobile.loading("show",{text:"Loading...",textVisible:"true",theme:"a",});var data={'keyword':"",'category':"",'card':"",'location':""};var url=serviceUrl+'search.php';$.ajax({type:"POST",url:url,data:data,success:function(result){$.mobile.loading("hide");if(Object.keys(result.search_card).length||Object.keys(result.search_keyword_cat).length){console.warn("Ther is a resule");all_data=result.search_keyword_cat;all_data_load=true;add_category_data(cat_id);}else{}},failure:function(err){console.error("reg error: "+err);},dataType:"json"});}}function add_category_data(cat_id){var output="";for(var i in all_data){if(all_data[i].category_id==cat_id){var img=imageUrl+all_data[i].default_image;var dist=cal_dist(all_data[i].latitude,all_data[i].longitude);console.info("in filter Distance from current pos: "+dist);dist=dist.toFixed(2);if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<div class='premium-item-box'><div class='premium-item-nice'><div class='premium-img-nice'><a href='#'  onclick='display_details(all_data["+i+"])'><img width='91px' src='"+img+"' /></a></div><div class='canter-taxt  '><div class='premium-item-text-nice'>"+all_data[i].title+"</div><div class='premium-item-te-nice'>"+all_data[i].location+"</div><div class='premium-item-te-nice'>"+all_data[i].card+"</div></div><div class='canter-taxt-1  '><div class='premium-item-te-nice-1'>"+all_data[i].category_id+"</div><div class='premium-item-te-nice-1'>"+all_data[i].offer_text+"</div></div></div><div class='right-text-nice  '>"+dist+"</div></div>";}}$('#div_cat_list').html(output);$.mobile.changePage('#category_page',{transition:'flow'});}function add_todays_info_to_slider(){console.warn("info_to_slider called");if(category_load&&card_load&&todayspecial_load){console.warn("in info to slider"+todayspecial_data);get_loc();var output="";var total_loc=all_locations.length;output='<div class="select-hading" onclick="$.mobile.changePage(\'#tspecial\', { transition: \'flow\'} );">Todayâ€™s Special<span>'+Object.keys(todayspecial_data).length+'</span></div>';for(var i=0;i<total_loc;i++){var name=all_locations[i][0].split('_').join(' ');output+=' <div class="special-box"><div class="near-me">'+name+'</div><div class="near-tex">'+(10+i)+'</div><div class="near-tex">'+(1+i)+'</div></div>';}output+='<div class="scan-btn"><a href="#"><img src="img/scan-btn.png" /></a></div>';$('#div_loc').append(output);$('#div_loc').listview();output="";output='<div class="select-hading" onclick="$.mobile.changePage(\'#tspecial\', { transition: \'flow\'} );">Todayâ€™s Special<span>'+Object.keys(todayspecial_data).length+'</span></div>';for(var i in category_data){output+=' <div class="special-box" onclick="call_category_page('+category_data[i].id+',\''+category_data[i].category_name+'\')" ><div class="near-me">'+category_data[i].category_name+'</div><div class="near-tex">'+(10+i)+'</div><div class="near-tex">'+(3+i)+'</div></div>';}output+='<div class="scan-btn"><a href="#"><img src="img/scan-btn.png" /></a></div>';$('#div_cat').append(output);$('#div_cat').listview();output="";output='<div class="select-hading" onclick="$.mobile.changePage(\'#tspecial\', { transition: \'flow\'} );">Todayâ€™s Special<span>'+Object.keys(todayspecial_data).length+'</span></div>';for(var i in card_data){output+=' <div class="special-box"><div class="near-me">'+card_data[i]+'</div><div class="near-tex">'+(6+i)+'</div><div class="near-tex">'+(2+i)+'</div></div>';}output+='<div class="scan-btn"><a href="#"><img src="img/scan-btn.png" /></a></div>';$('#div_card').append(output);$('#div_card').listview();$("#mainslider").listview();$('#mainslider').bxSlider({infiniteLoop:false,hideControlOnEnd:true,controls:false,adaptiveHeight:true,preloadImages:'all',slideMargin:12});}}function add_premium_list_to_slider(){var output="";for(var i in premiumoffers_data){var img=imageUrl+premiumoffers_data[i].default_image;output+='<li><ul data-role="listview" style="list-style-type: none;"><li><article><div class="select-main-box-pro"><div class="premium-h">Premium <span>Listing</span></div><div class="premium-item"><div class="premium-img"><a onclick="display_details(premiumoffers_data['+i+'])" href="#"><img src="'+img+'" /></a></div><div class="premium-item-text">'+premiumoffers_data[i].title+'</div><div class="premium-item-te">'+premiumoffers_data[i].offer_text+'<br />'+premiumoffers_data[i].card+'</div></div><div class="right-text">'+premiumoffers_data[i].location+'</div></div></article></li></ul></li>';}$('#preslider').append(output);$('#preslider').bxSlider({infiniteLoop:false,hideControlOnEnd:true,controls:false,adaptiveHeight:true,});}function add_adverts_to_slider(){var output="";for(var i in adverts_data){var img=imageUrl+adverts_data[i].offer_image;output+='<li><img src="'+img+'"  onclick="$.mobile.changePage(\'#advertpage\', { transition: \'flow\'} );" alt="Picture" style="height: 24vh;width: 100vw;" /></li>';}$('#adslider').append(output);$('#adslider').bxSlider({infiniteLoop:false,hideControlOnEnd:true,controls:false,adaptiveHeight:true});}function injectMenu(){var pagelist=["#mainpage","#tspecial"];for(var i=0,p_len=pagelist.length;i<p_len;i++){$("<div class='ui-bar-b' data-role='panel' id='menuPanel'><ul data-role='listview' data-inset='true' data-divider-theme='b'<li><a href='#mainpage'>Home</a></li><li><a onclick='scanCode()' href='#'>Barcode</a></li><li><a href='#'>Sign Up</a></li><li><a href='#'>Login</a></li><li data-role='list-divider'>categories</li><li><a href='#'>Womens</a></li><li><a href='#'>Mens</a></li><li><a href='#'>Features</a></li><li><a href='#'>Brands</a></li><li data-role='list-divider'>Other</li><li><a href='#'>Point</a></li><li><a href='#tspecial'>Discount</a></li><li><a href='#'>Notification</a></li><li><a href='#'>LBS</a></li><li><a href='#'>All cards</a></li></ul></div>").appendTo("'"+pagelist[i]+"'");}alert("after injectMenu");}function create_footer(){}function show_popup(){var options={transition:"slideup",};$("#transitionExample").popup("open",options);}var scanCode=function(){cordova.plugins.barcodeScanner.scan(function(result){alert("Scanned Code: "+result.text+". Format: "+result.format+". Cancelled: "+result.cancelled);},function(error){alert("Scan failed: "+error);});};var encodeText=function(){window.plugins.barcodeScanner.encode(BarcodeScanner.Encode.TEXT_TYPE,"http://www.mobiledevelopersolutions.com",function(success){alert("Encode success: "+success);},function(fail){alert("Encoding failed: "+fail);});};var encodeEmail=function(){window.plugins.barcodeScanner.encode(BarcodeScanner.Encode.EMAIL_TYPE,"a.name@gmail.com",function(success){alert("Encode success: "+success);},function(fail){alert("Encoding failed: "+fail);});};var encodePhone=function(){window.plugins.barcodeScanner.encode(BarcodeScanner.Encode.PHONE_TYPE,"555-227-5283",function(success){alert("Encode success: "+success);},function(fail){alert("Encoding failed: "+fail);});};var encodeSMS=function(){window.plugins.barcodeScanner.encode(BarcodeScanner.Encode.SMS_TYPE,"An important message for someone.",function(success){alert("Encode success: "+success);},function(fail){alert("Encoding failed: "+fail);});};function getposition(){var onSuccess=function(position){var current_location=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);localStorage.setItem('current_pos',current_location);};function onError(error){alert('code: '+error.code+'\n'+'message: '+error.message+'\n');}navigator.geolocation.getCurrentPosition(onSuccess,onError);}function save_current_loc(){var onSuccess=function(position){current_lat=position.coords.latitude;current_lun=position.coords.longitude;};function onError(error){alert('code: '+error.code+'\n'+'message: '+error.message+'\n');}navigator.geolocation.getCurrentPosition(onSuccess,onError);}function add_loc_getposition(){var onSuccess=function(position){var tmp_LatLng='('+position.coords.latitude+', '+position.coords.longitude+')';localStorage.setItem('tmp_LatLng',tmp_LatLng);$('#loc_latlng').val(tmp_LatLng);};function onError(error){alert('code: '+error.code+'\n'+'message: '+error.message+'\n');}navigator.geolocation.getCurrentPosition(onSuccess,onError);}function save_loc(){var name_loc=$('#loc_name').val(),pos=localStorage.getItem("tmp_LatLng"),obj=localStorage.getItem("locations");var name=name_loc.split(' ').join('_');obj=JSON.parse(obj);obj[name]=pos;console.warn(obj);obj=JSON.stringify(obj);localStorage.setItem('locations',obj);reset_loc();get_loc();}function get_loc(){var tmp_loc=JSON.parse(localStorage.getItem("locations"));all_locations=_.pairs(tmp_loc);}function reset_loc(){$('#loc_name').val("");$('#loc_latlng').val("");$('#loc_slider').val('map').slider("refresh");$('#loc_slider').change();console.info(category_data);}function add_location_temp(){var temp_LatLng=localStorage.getItem("current_pos");localStorage.setItem("tmp_LatLng",temp_LatLng);$('#loc_latlng').val(temp_LatLng);}function nexttab(){var active_tab=$("#tabs").tabs("option","active");active_tab++;$('#tabs').tabs({active:active_tab});var tabli=$('#tabs ul li[tabindex='+active_tab+']');var tabLink=$('#tabs ul li[tabindex='+active_tab+'] a');}function set_home_location(){var home_LatLng=localStorage.getItem("current_pos"),obj={};localStorage.setItem('home_location',home_LatLng);obj["Home"]=home_LatLng;obj=JSON.stringify(obj);localStorage.setItem('locations',obj);}function save_setup(){var setup_info={gender:"",ageGroup:"",maritalStatus:"",phone:"",nearbyNotiDist:"",catPref:"",alert:""};setup_info.gender=$('#txtgender').val();setup_info.ageGroup=$('#txtageg').val();setup_info.maritalStatus=$('#txtmaritalstatus').val();setup_info.phone=$('#txtphone').val();setup_info.nearbyNotiDist=$('#select-distance').val();setup_info.alert=$("input:radio[name='radio-choice-v-2']:checked").val();var realvalues=[];var textvalues=[];$('#selectmul-categorys :selected').each(function(i,selected){realvalues[i]=$(selected).val();textvalues[i]=$(selected).text();});setup_info.catPref=realvalues;var str_setup=JSON.stringify(setup_info);localStorage.setItem('setup',str_setup);localStorage.setItem('user_profile',1);set_home_location();$.mobile.changePage('#mainpage');location.reload(true);}function refreshPage(){$.mobile.changePage(window.location.href,{allowSamePageTransition:true,transition:'none',showLoadMsg:false,reloadPage:true});}function add_loc_list(list_id){var total_loc=all_locations.length,html_out='<option value="all">All</option>';for(var i=0;i<total_loc;i++){var name=all_locations[i][0].split('_').join(' ');html_out+='<option value="'+i+'">'+name+'</option>';}$(list_id).html(html_out).select("refresh");}function add_card_list(list_id){var total_card=Object.keys(card_data).length,html_out='<option value="all">All</option>';for(var i=0;i<total_card;i++){html_out+='<option value="'+card_data[i]+'">'+card_data[i]+'</option>';}console.info(html_out);$(list_id).html(html_out).select("refresh");}function add_cat_list(list_id){var total_cat=Object.keys(category_data).length,html_out='<option value="all">All</option>';for(var i=0;i<total_cat;i++){html_out+='<option value="'+category_data[i].id+'">'+category_data[i].category_name+'</option>';}console.info(html_out);$(list_id).html(html_out).select("refresh");}function add_cat_on_startup(){var url=serviceUrl+'category.php';$.post(url,function(myData){var html_out='<option>Choose options</option>',html_li='<li data-option-index="0" data-icon="false" data-placeholder="true" class="ui-screen-hidden" role="option" aria-selected="false"><a href="#" tabindex="-1" class="ui-btn ui-checkbox-off ui-btn-icon-right">Choose options</a></li>';for(var i in myData.category){html_out+='<option value="'+myData.category[i].id+'">'+myData.category[i].category_name+'</option>';html_li+='<li data-option-index="'+(parseInt(i)+parseInt(1))+'" data-icon="false" class="ui-first-child" role="option" aria-selected="false"><a href="#" tabindex="-1" class="ui-btn ui-btn-icon-right ui-checkbox-off">'+myData.category[i].category_name+'</a></li>';}$('div.formspace #v_state').append('<option selected="selected" value="TX">Texas</option>').selectmenu("refresh");$("#three form div #selectmul-categorys").html(html_out).select("refresh");$("#selectmul-categorys-menu").html(html_li);},'json');}function reset_todays_page(){$('#select-category').val("all");$('#select-card').val("all");$('#select-loc').val("all");$('#slider').val(0);}function rad2deg(angle){return angle*57.29577951308232;}function deg2rad(angle){return angle*.017453292519943295;}function is_in_radius(lat,lug,max_lat,min_lat,max_lug,min_lug){if(min_lat<lat&&max_lat>lat){if(min_lug<lug&&max_lug>lug){return true}else{return false}}else{return false}}function maxmin_latlun(){var distance=6,lat=current_lat,lng=current_lun;var radius=6371;var max_lat=lat+rad2deg(distance/radius);var min_lat=lat-rad2deg(distance/radius);var max_lng=lng+rad2deg(distance/radius/Math.cos(deg2rad(lat)));var min_lng=lng-rad2deg(distance/radius/Math.cos(deg2rad(lat)));var mm_latlun={maxlat:max_lat,minlat:min_lat,maxlng:max_lng,minlng:min_lng};console.info("maxlat: "+mm_latlun.maxlat+" minlat: "+mm_latlun.minlat+" maxlng: "+mm_latlun.maxlng+" minlng: "+mm_latlun.minlng);return mm_latlun}function cal_dist(place_lat,place_lun){var lat1=current_lat,lon1=current_lun,lat2=place_lat,lon2=place_lun,unit="K";var radlat1=Math.PI*lat1/180
var radlat2=Math.PI*lat2/180
var radlon1=Math.PI*lon1/180
var radlon2=Math.PI*lon2/180
var theta=lon1-lon2
var radtheta=Math.PI*theta/180
var dist=Math.sin(radlat1)*Math.sin(radlat2)+Math.cos(radlat1)*Math.cos(radlat2)*Math.cos(radtheta);dist=Math.acos(dist)dist=dist*180/Math.PI
dist=dist*60*1.1515
if(unit=="K"){dist=dist*1.609344}if(unit=="N"){dist=dist*0.8684}console.info("in dist_fun Distance from current pos: "+dist);return dist}function filter_list_cat(fil){var output="";if(fil){if(fil=="all"||fil=="ALL"){for(var i in todayspecial_data){var img=imageUrl+todayspecial_data[i].default_image;var dist=cal_dist(todayspecial_data[i].latitude,todayspecial_data[i].longitude);console.info("in filter Distance from current pos: "+dist);dist=dist.toFixed(2);if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<div class='premium-item-box'><div class='premium-item-nice'><div class='premium-img-nice'><a href='#'  onclick='display_details(todayspecial_data["+i+"])'><img width='91px' src='"+img+"' /></a></div><div class='canter-taxt  '><div class='premium-item-text-nice'>"+todayspecial_data[i].title+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].location+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].card+"</div></div><div class='canter-taxt-1  '><div class='premium-item-te-nice-1'>"+todayspecial_data[i].category_id+"</div><div class='premium-item-te-nice-1'>"+todayspecial_data[i].offer_text+"</div></div></div><div class='right-text-nice  '>"+dist+"</div></div>";}}else{for(var i in todayspecial_data){if(todayspecial_data[i].category_id==fil){var img=imageUrl+todayspecial_data[i].default_image;var dist=cal_dist(todayspecial_data[i].latitude,todayspecial_data[i].longitude);console.info("in filter Distance from current pos: "+dist);dist=dist.toFixed(2);if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<div class='premium-item-box'><div class='premium-item-nice'><div class='premium-img-nice'><a href='#'  onclick='display_details(todayspecial_data["+i+"])'><img width='91px' src='"+img+"' /></a></div><div class='canter-taxt  '><div class='premium-item-text-nice'>"+todayspecial_data[i].title+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].location+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].card+"</div></div><div class='canter-taxt-1  '><div class='premium-item-te-nice-1'>"+todayspecial_data[i].category_id+"</div><div class='premium-item-te-nice-1'>"+todayspecial_data[i].offer_text+"</div></div></div><div class='right-text-nice  '>"+dist+"</div></div>";}}}}else{for(var i in todayspecial_data){var img=imageUrl+todayspecial_data[i].default_image;var dist=cal_dist(todayspecial_data[i].latitude,todayspecial_data[i].longitude);console.info("in filter Distance from current pos: "+dist);dist=dist.toFixed(2);if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<div class='premium-item-box'><div class='premium-item-nice'><div class='premium-img-nice'><a href='#'  onclick='display_details(todayspecial_data["+i+"])'><img width='91px' src='"+img+"' /></a></div><div class='canter-taxt  '><div class='premium-item-text-nice'>"+todayspecial_data[i].title+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].location+"</div><div class='premium-item-te-nice'>"+todayspecial_data[i].card+"</div></div><div class='canter-taxt-1  '><div class='premium-item-te-nice-1'>"+todayspecial_data[i].category_id+"</div><div class='premium-item-te-nice-1'>"+todayspecial_data[i].offer_text+"</div></div></div><div class='right-text-nice  '>"+dist+"</div></div>";}}$('#div_List').html(output);}function filter_card(fil){$.getJSON('todays.json',function(data){var output="";if(fil){if(fil=="all"){for(var i in data.todays){var dist=data.todays[i].dist;if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<li><a href='"+data.todays[i].href+"'> <img src='"+data.todays[i].img+"'> <div class='ui-grid-a'><div class='ui-block-a'><div class='ui-bar' style='height:60px'> <h2>"+data.todays[i].name+"</h2> <p>"+data.todays[i].place+"</p> <p>"+data.todays[i].cards+"</p></div></div><div class='ui-block-b'><div class='ui-bar' style='height:60px'><h3 style='text-align: -webkit-right;'>"+data.todays[i].category+"</h3><p style='text-align: -webkit-right;'>"+data.todays[i].offer+"</p><p style='text-align: -webkit-right;'>"+dist+"</p></div></div></div></a></li>";}}else{for(var i in data.todays){var c_list=data.todays[i].cards.split("/");if(_.contains(c_list,fil)){var dist=data.todays[i].dist;if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<li><a href='"+data.todays[i].href+"'> <img src='"+data.todays[i].img+"'> <div class='ui-grid-a'><div class='ui-block-a'><div class='ui-bar' style='height:60px'> <h2>"+data.todays[i].name+"</h2> <p>"+data.todays[i].place+"</p> <p>"+data.todays[i].cards+"</p></div></div><div class='ui-block-b'><div class='ui-bar' style='height:60px'><h3 style='text-align: -webkit-right;'>"+data.todays[i].category+"</h3><p style='text-align: -webkit-right;'>"+data.todays[i].offer+"</p><p style='text-align: -webkit-right;'>"+dist+"</p></div></div></div></a></li>";}}}}$("#ListDiv").html('<ul id="List" data-role="listview"></ul>');$('#List').append(output);$('#List').listview();});}function filter_range(fil){$.getJSON('todays.json',function(data){var output="";if(fil){if(fil==0){for(var i in data.todays){var dist=data.todays[i].dist;if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<li><a href='"+data.todays[i].href+"'> <img src='"+data.todays[i].img+"'> <div class='ui-grid-a'><div class='ui-block-a'><div class='ui-bar' style='height:60px'> <h2>"+data.todays[i].name+"</h2> <p>"+data.todays[i].place+"</p> <p>"+data.todays[i].cards+"</p></div></div><div class='ui-block-b'><div class='ui-bar' style='height:60px'><h3 style='text-align: -webkit-right;'>"+data.todays[i].category+"</h3><p style='text-align: -webkit-right;'>"+data.todays[i].offer+"</p><p style='text-align: -webkit-right;'>"+dist+"</p></div></div></div></a></li>";}}else{for(var i in data.todays){var dist=data.todays[i].dist;if(dist<=fil){if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<li><a href='"+data.todays[i].href+"'> <img src='"+data.todays[i].img+"'> <div class='ui-grid-a'><div class='ui-block-a'><div class='ui-bar' style='height:60px'> <h2>"+data.todays[i].name+"</h2> <p>"+data.todays[i].place+"</p> <p>"+data.todays[i].cards+"</p></div></div><div class='ui-block-b'><div class='ui-bar' style='height:60px'><h3 style='text-align: -webkit-right;'>"+data.todays[i].category+"</h3><p style='text-align: -webkit-right;'>"+data.todays[i].offer+"</p><p style='text-align: -webkit-right;'>"+dist+"</p></div></div></div></a></li>";}}}}$("#ListDiv").html('<ul id="List" data-role="listview"></ul>');$('#List').append(output);$('#List').listview();});}function fashion_gallery(){var output="";$.getJSON('fashion_gallery.json',function(data){output='<tr><td>Nearest:</td><td style="color:#f48115;">'+data.nearest+'</td></tr><tr><td>Other:</td><td style="color:#f48115;">'+data.other+'</td></tr><tr><td>Hours:</td><td style="color:#f48115;">'+data.hours+'</td></tr><tr><td>Offer:</td><td style="color:#f48115;">'+data.offer+'</td></tr><tr><td>Valid:</td><td style="color:#f48115;">'+data.valid+'</td></tr>';});}function login_cancle(){$('#login_email').val("");$('#password').val("");}function login(){$.mobile.loading("show",{text:"Login...",textVisible:"true",theme:"a",});var login_as=$('#select-login').val(),login_email=$('#login_email').val(),login_pass=$('#password').val();var data={'email':login_email,'password':login_pass,'company_type':login_as};var url=serviceUrl+'login.php';$.ajax({type:"POST",url:url,data:data,success:function(result){$.mobile.loading("hide");var stat;if(result.status==0){stat="Invalid username or password";}else if(result.status==1){stat="Login successfully";}else if(result.status==2){stat="Please provide complete information";}$.mobile.loading("show",{text:stat,textVisible:"true",textonly:"textonly",theme:"a",});setTimeout(function(){$.mobile.loading("hide");if(result.status==1){$.mobile.changePage("#mainpage");}},3000);},failure:function(err){console.error("reg error: "+err);$.mobile.loading("hide");},dataType:"json"});}function reset_reg(){$('#email').val("");$('#name').val("");$('#cpass').val("");$('#companyreg').val("");$('#company-type').val("Mall");$('#company-type').selectmenu("refresh");$('#country').val("india");$('#country').selectmenu("refresh");}function register(){$.mobile.loading("show",{text:"Register...",textVisible:"true",theme:"a",});var cemail=$('#email').val(),cname=$('#name').val(),cpass=$('#cpass').val(),creg=$('#companyreg').val(),ctype=$('#company-type').val(),country=$('#country').val();var data={'email':cemail,'password':cpass,'company_name':cname,'comp_reg_number':creg,'company_type':ctype,'country_comp_reg_in':country};var url=serviceUrl+'register.php';$.ajax({type:"POST",url:url,data:data,success:function(result){console.info(result);$.mobile.loading("hide");var stat;if(result.status==0){stat="Some other problem to register user";}if(result.status==1){stat="User Register Successfully";}if(result.status==3){stat="Please provide complete information";}$.mobile.loading("show",{text:stat,textVisible:"true",textonly:"textonly",theme:"a",});setTimeout(function(){$.mobile.loading("hide");if(result.status==1){localStorage.setItem('user_id',result.user_id);$.mobile.changePage("#mainpage");}},3000);},failure:function(err){console.error("reg error: "+err);},dataType:"json"});}function reset_search(){$('#keywords').val("");$('#search_category').val("all");$('#search_category').selectmenu("refresh");$('#search_card').val("all");$('#search_card').selectmenu("refresh");$('#search_location').val("all");$('#search_location').selectmenu("refresh");}function display_search(s_data){var output="";var res_data=_.intersection(s_data.search_keyword_cat,s_data.search_card);for(var i in s_data.search_keyword_cat){var img=imageUrl+s_data.search_keyword_cat[i].default_image;var dist=(Math.random()*5)+1;dist=dist.toFixed(2)if(dist<1){dist=(dist*1000);dist=dist+"m";}else{dist=dist+"km";}output+="<div class='premium-item-box'><div class='premium-item-nice'><div class='premium-img-nice'><a href='#'  onclick='display_details(search_result_data.search_keyword_cat["+i+"])'><img width='91px' src='"+img+"' /></a></div><div class='canter-taxt  '><div class='premium-item-text-nice'>"+s_data.search_keyword_cat[i].title+"</div><div class='premium-item-te-nice'>"+s_data.search_keyword_cat[i].location+"</div><div class='premium-item-te-nice'>"+s_data.search_keyword_cat[i].card+"</div></div><div class='canter-taxt-1  '><div class='premium-item-te-nice-1'>"+s_data.search_keyword_cat[i].category_id+"</div><div class='premium-item-te-nice-1'>"+s_data.search_keyword_cat[i].offer_text+"</div></div></div><div class='right-text-nice  '>"+dist+"</div></div>";}$("#search_pg_ListDiv").html('<ul id="search_List" data-role="listview"></ul>');$('#search_List').append(output);$('#search_List').listview();$.mobile.changePage('#search_result_pg');}function search_key(){$.mobile.loading("show",{text:"Searching...",textVisible:"true",theme:"a",});var s_keyword=$('#keywords').val(),s_category=$('#search_category').val(),s_card=$('#search_card').val();if(s_category=="all"){s_category="*";}if(s_card=="all"){s_card="*";}var data={'keyword':s_keyword,'category':s_category,'card':s_card,'location':"50"};var url=serviceUrl+'search.php';$.ajax({type:"POST",url:url,data:data,success:function(result){$.mobile.loading("hide");console.info(result);if(Object.keys(result.search_card).length||Object.keys(result.search_keyword_cat).length){console.warn("Ther is a resule");search_result_data=result;display_search(result);}else{$('#popup_result_notfound').popup('open');}},failure:function(err){console.error("reg error: "+err);},dataType:"json"});}function display_details(list_data){var html_out,html_img,img_src;img_src=imageUrl+list_data.default_image;html_img='<img width="100%" src="'+img_src+'">';$("#details_div_img").html(html_img);$("#details_title").html(list_data.title);html_out='<tr><td>Card:</td><td style="color:#f48115;">'+list_data.card+'</td></tr><tr><td>Location:</td><td style="color:#f48115;">'+list_data.location+'</td></tr><tr><td>Hours:</td><td style="color:#f48115;">'+list_data.hours+'</td></tr><tr><td>Offer:</td><td style="color:#f48115;">'+list_data.offer_text+'</td></tr><tr><td>Discount:</td><td style="color:#f48115;">'+list_data.discount_amt+'</td></tr><tr><td>Description:</td><td style="color:#f48115;">'+list_data.description+'</td></tr><tr><td>Valid:</td><td style="color:#f48115;">'+list_data.start_date+' to '+list_data.end_date+'</td></tr><tr><td>Terms & condition:</td><td style="color:#f48115;">'+list_data.terms_condition+'</td></tr>';$('#details_tbody').html(html_out);$.mobile.changePage('#details_pg');}